{% extends "base.html" %}
{% load static %}

{% block title %}Edit your profile{% endblock %}

{% block content %}
  <form method="post" enctype="multipart/form-data" id="form-container">
  <div class="content-header">
    <h1>Edit your profile</h1>
    {% csrf_token %}
    <p><input type="submit" value="Save changes"></p>
    <!-- todo: doesn't save anything when up here for some reason?? -->
  </div>
  <!-- TODO: add verification errors {{ field.errors }} -->

  <div class="profile">
      {% with vform=vcard_form %}
      {% with pform=profile_form %}
      <div class="profilePhoto">
        <!-- todo: this ain't pretty -->
        {{ pform.photo }}
      </div>
      <div class="text-container">
        <p>{{ vform.prefix.label_tag }} {{ vform.prefix }}</p>
        <p>{{ vform.first_name.label_tag }} {{ vform.first_name }}</p>
        <p>{{ vform.middle_name.label_tag }} {{ vform.middle_name }}</p>
        <p>{{ vform.last_name.label_tag }} {{ vform.last_name }}</p>
        <p>{{ vform.suffix.label_tag }} {{ vform.suffix }}</p>
        <p>{{ vform.nickname.label_tag }} {{ vform.nickname }}</p>

        <p>{{ pform.headline.label_tag }} {{ pform.headline }}</p>
        <p>{{ pform.location.label_tag }} {{ pform.location }}</p>
        <p>{{ pform.description.label_tag }} {{ pform.description }}</p>
      </div>
    </div>
    {% endwith %} <!-- end pform -->
    <!-- vform ends after personal -->

    <div class="vcard">
      <h2>Contact Info</h2>
      <p>{{ vform.kind.label_tag }} {{ vform.kind }}</p>
      
      <div class="vcardGroup">
        <h3>Phone</h3>
        <div id="phone-form-container">
          {{ phone_formset.management_form }}
          {% for form in phone_formset %}
          <div class="phone-form">
            {{ form.as_div }}
          </div>
          {% endfor %}
          <button id="add-phone-form" type="button">Add Phone</button>
        </div>
      </div>

      <!-- todo: remove the delete button on new forms using if form.instance.pk render form.DELETE -->
      <div class="vcardGroup">
        <h3>Email</h3>
        <div id="email-form-container">
          {{ email_formset.management_form }}
          {% for form in email_formset %}
          <div class="email-form">
            {{ form.as_div }}
          </div>
          {% endfor %}
          <button id="add-email-form" type="button">Add Email</button>
        </div>
      </div>

      <div class="vcardGroup">
        <h3>URLs</h3>
        <div id="url-form-container">
          {{ url_formset.management_form }}
          {% for form in url_formset %}
          <div class="url-form">
            {{ form.as_div }}
          </div>
          {% endfor %}
          <button id="add-url-form" type="button">Add URL</button>
        </div>
      </div>

      <div class="vcardGroup">
        <h3>Addresses</h3>
        <div id="address-form-container">
          {{ address_formset.management_form }}
          {% for form in address_formset %}
          <div class="address-form">
            {{ form.as_div }}
          </div>
          {% endfor %}
          <button id="add-address-form" type="button">Add Address</button>
        </div>
      </div>

      <div class="vcardGroup">
        <h3>Organization</h3>
        <div class="org-form-container">
          {{ org_formset.management_form }}
          {% for form in org_formset %}
          <div class="org-form">
            {{ form.as_div }}
          </div>
          {% endfor %}
          <button id="add-org-form" type="button">Add Organization</button>
        </div>
      </div>

      <div class="vcardGroup">
        <h3>Personal</h3>
        <div class="text-container">
          <!-- todo: need to use the yearlessdate form here so has dropdowns -->
          <p>{{ vform.birthday.label_tag }} {{ vform.birthday }}</p>
          <p>{{ vform.anniversary.label_tag }} {{ vform.anniversary }}</p>
          <p>Biological sex: {{ vform.sex }}</p>
          <p>Gender: {{ vform.gender }}</p>
        </div>
      </div>

      <div class="vcardGroup">
        <h3>Tags</h3>
        <div id="tag-form-container">
          {{ tag_formset.management_form }}
          {% for form in tag_formset %}
          <div class="tag-form">
            {{ form.as_div }}
          </div>
          {% endfor %}
          <button id="add-tag-form" type="button">Add Tag</button>
        </div>
      </div>

      <div class="vcardGroup">
        <h3>Note</h3>
        {{ vform.note }}
      </div>
      {% endwith %} <!-- end vform -->

  </div>
  </form>
  <script src="{% static "js/edit_profile.js" %}"></script>
{% endblock %}
