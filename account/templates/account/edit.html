{% extends "base.html" %}
{% load static %}

{% block title %}Edit your profile{% endblock %}

{% block content %}
  <form method="post" enctype="multipart/form-data" id="form-container">
  <div class="content-header">
    {% if mode == "edit" %}<h1>Edit Card</h1>{% endif %}
    {% if mode == "new" %}<h1>New Card</h1>{% endif%}
    {% if mode == "self" %}<h1>Edit your profile and card</h1>{% endif %}
    <!-- todo: update to display different if creating new -->
    {% csrf_token %}
    <p><input type="submit" value="Save changes"></p>
  </div>

  <div class="profile">
      {% with cform=card_form %}
      <div class="profilePhoto">
        <!-- todo: this ain't pretty -->
        {{ cform.photo }}
      </div>
      <div class="text-container">
        <p>{{ cform.prefix.label_tag }} {{ cform.prefix }} {{ cform.prefix.errors }}</p>
        <p>{{ cform.first_name.label_tag }} {{ cform.first_name }} {{ cform.first_name.errors }}</p>
        <p>{{ cform.middle_name.label_tag }} {{ cform.middle_name }} {{ cform.middle_name.errors }}</p>
        <p>{{ cform.last_name.label_tag }} {{ cform.last_name }} {{ cform.last_name.errors }}</p>
        <p>{{ cform.suffix.label_tag }} {{ cform.suffix }} {{ cform.suffix.errors }}</p>
        <p>{{ cform.nickname.label_tag }} {{ cform.nickname }} {{ cform.nickname.errors }}</p>

        {% with pform=profile_form %}
        {% if pform %}
        <p>{{ pform.headline.label_tag }} {{ pform.headline }} {{ pform.headline.errors }}</p>
        <p>{{ pform.location.label_tag }} {{ pform.location }} {{ pform.location.errors }}</p>
        <p>{{ pform.description.label_tag }} {{ pform.description }} {{ pform.description.errors }}</p>
        {% endif %}
        {% endwith %}
      </div>
    </div>

    <div class="card">
      <h2>Contact Info</h2>
      <p>{{ cform.kind.label_tag }} {{ cform.kind }} {{ cform.kind.errors }}</p>
      
      <div class="cardGroup">
        <h3>Phone</h3>
        <div id="phone-form-container">
          {{ phone_formset.management_form }}
          {% for form in phone_formset %}
          <div class="phone-form">
            {{ form.as_div }}
          </div>
          {% endfor %}
          <button id="add-phone-form" type="button">Add Phone</button>
        </div>
      </div>

      <!-- todo: remove the delete button on new forms using if form.instance.pk render form.DELETE -->
      <div class="cardGroup">
        <h3>Email</h3>
        <div id="email-form-container">
          {{ email_formset.management_form }}
          {% for form in email_formset %}
          <div class="email-form">
            {{ form.as_div }}
          </div>
          {% endfor %}
          <button id="add-email-form" type="button">Add Email</button>
        </div>
      </div>

      <div class="cardGroup">
        <h3>URLs</h3>
        <div id="url-form-container">
          {{ url_formset.management_form }}
          {% for form in url_formset %}
          <div class="url-form">
            {{ form.as_div }}
          </div>
          {% endfor %}
          <button id="add-url-form" type="button">Add URL</button>
        </div>
      </div>

      <div class="cardGroup">
        <h3>Addresses</h3>
        <div id="address-form-container">
          {{ address_formset.management_form }}
          {% for form in address_formset %}
          <div class="address-form">
            {{ form.as_div }}
          </div>
          {% endfor %}
          <button id="add-address-form" type="button">Add Address</button>
        </div>
      </div>

      <div class="cardGroup">
        <h3>Organization</h3>
        <div id="organization-form-container">
          {{ org_formset.management_form }}
          {% for form in org_formset %}
          <div class="organization-form">
            {{ form.as_div }}
          </div>
          {% endfor %}
          <button id="add-organization-form" type="button">Add Organization</button>
        </div>

        <div id="title-form-container">
          {{ title_formset.management_form }}
          {% for form in title_formset %}
          <div class="title-from">
            {{ form.as_div }}
          </div>
          {% endfor %}
          <button id="add-title-form" type="button">Add Title</button>
        </div>

        <div id="role-form-container">
          {{ role_formset.management_form }}
          {% for form in role_formset %}
          <div class="role-form">
            {{ form.as_div }}
          </div>
          {% endfor %}
          <button id="add-role-form" type="button">Add Role</button>
        </div>
      </div>

      <div class="cardGroup">
        <h3>Personal</h3>
        <div class="text-container">
          <p>{{ cform.birthday.label_tag }}{{ cform.birthday }} {{ cform.birthday.errors }}</p>
          <p>{{ cform.birthday_year.label_tag }} {{ cform.birthday_year }} {{ cform.birthday_year.errors }}</p>
          <p>{{ cform.anniversary.label_tag }} {{ cform.anniversary }} {{ cform.anniversary.errors }}</p>
          <p>{{ cform.anniversary_year.label_tag }} {{ cform.anniversary_year }} {{ cform.anniversary_year.errors }}</p>
          <p>Biological sex: {{ cform.sex }} {{ cform.sex.errors }}</p>
          <p>Gender: {{ cform.gender }} {{ cform.gender.errors }}</p>
        </div>
      </div>

      <div class="cardGroup">
        <h3>Tags</h3>
        <div id="tag-form-container">
          {{ tag_formset.management_form }}
          {% for form in tag_formset %}
          <div class="tag-form">
            {{ form.as_div }}
          </div>
          {% endfor %}
          <button id="add-tag-form" type="button">Add Tag</button>
        </div>
      </div>

      <div class="cardGroup">
        <h3>Note</h3>
        {{ cform.note }} {{ cform.note.errors }}
      </div>
      {% endwith %} <!-- end cform -->

  </div>
  </form>
  <script src="{% static "js/edit_profile.js" %}"></script>
{% endblock %}
