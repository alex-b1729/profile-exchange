{% extends "base.html" %}
{% load static %}
{% load profile_extras %}

{% block title %}
{% if profile.user == request.user %}
{{ profile.title }}
{% else %}
{{ profile.fn }} |
{% endif %}
Profile
{% endblock %}

{% block content %}

{# user profile details #}
{% if profile.user == request.user %}
<div class="mb-3 position-relative">
  <h4 class="mb-1">{{ profile.title }} Profile</h4>
  <p class="mb-2 text-muted fst-italic">Kind: {{ profile.get_kind_display }}</p>
  {% if profile.description %}
  <p class="">{{ profile.description }}</p>
  {% endif %}

  <span class="position-absolute top-0 end-0">
    <a
            href="{% url 'profile_edit' profile.pk %}"
            class="btn btn-sm btn-outline-light border border-0 rounded"
            role="button"
            title="Edit">
      <svg class="bi" width="16" height="16">
          <use href="{% static 'svg_spiritsheet.svg' %}#pencil-square"></use>
      </svg>
    </a>
  </span>
</div>
<hr/>
{% endif %}

{% if profile.user == request.user %}
{# from bootstrap https://htmx.org/examples/modal-bootstrap/ #}
{# share profile modal and update image #}
<div id="modals-here"
    class="modal modal-blur fade"
    style="display: none"
    aria-hidden="false"
    tabindex="-1">
    <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
        <div class="modal-content"></div>
    </div>
</div>

<div id="update-img-model"
    class="modal modal-blur fade"
    style="display: none"
    aria-hidden="false"
    tabindex="-1">
    <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
        <div class="modal-content"></div>
    </div>
</div>
{% endif %}

{# heading and pic #}
<div class="container p-3 mb-3 d-md-flex">
  <div class="me-5 mb-3 d-flex flex-column">
    {% include 'profile/partials/photo.html' with profile=profile %}
  </div>

  <div class="justify-content-left flex-wrap position-relative">
    {% include 'profile/partials/header.html' with profile=profile %}

    {% if request.user == profile.user %}
    <span class="position-absolute top-0 end-0">
      <a
              href="{% url 'profile_edit' profile.pk %}"
              class="btn btn-sm btn-outline-light border border-0 rounded"
              role="button"
              title="Edit">
        <svg class="bi" width="16" height="16">
            <use href="{% static 'svg_spiritsheet.svg' %}#pencil-square"></use>
        </svg>
      </a>
    </span>
    {% endif %}
  </div>
</div>

{% if request.user == profile.user %}
<ul class="">
  {% comment %}
  <li>
    <button
      hx-get="#" {# url share #}
      hx-target="#modals-here"
      hx-trigger="click"
      data-bs-toggle="modal"
      data-bs-target="#modals-here"
      class="dropdown-item">Share</button>
  </li>
  <li>
    <a class="dropdown-item" href="#">Download</a> {# url 'download_card' #}
  </li>
  {% endcomment %}
  <li>
    <a class="" href="{% url 'profile_links' profile.pk %}">Links</a>
  </li>
</ul>
{% endif %}

{# content #}
<div class="container" id="profile-content">
  {% include 'profile/partials/content.html' with profile=profile %}
</div>

{% endblock %}

{% block domready %}
{% if request.user == profile.user %}
$('#contents').sortable({
  handle: ".handle",
  stop: function(event, ui) {
    contents_order = {};
    $('#contents').children().each(function() {
      // update order field
      $(this).find('.order').text($(this).index() + 1);
      // associate the content's id with its order
      contents_order[$(this).data('id')] = $(this).index();
    });
    $.ajax({
      type: 'POST',
      url: '{% url 'content_order' %}',
      contentType: 'application/json; charset=utf-8',
      dataType: 'json',
        data: JSON.stringify(contents_order)
    });
  }
});
{% endif %}
{% endblock %}