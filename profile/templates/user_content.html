{% extends "base.html" %}
{% load thumbnail %}
{% load static %}
{% load profile_extras %}

{% block title %}
My Content
{% endblock %}

{% block content %}

<h1>My Content</h1>
<p>Hey {{ request.user.username }}, here's all your content.</p>
<p>Mix and match these items in your <a href="{% url 'profile_list' %}">profiles</a>.</p>
<a href="{% url 'add_item' %}" class="btn btn-primary">Add Content</a>
<hr />

{% for category, mods in content_dict.items %}
{% if mods %}
<div class="card mb-3">
    <div class="card-header">
        {{ category }}
    </div>
    <div class="card-body">
        {% for mod, objs in mods.items %}
        {% with mod_name=mod|cut:' '|lower %}
        <h5 class="card-title">{{ mod }}</h5>
        <ul class="list-group list-group-flush">
            {% for obj in objs %}
            <li class="list-group-item">
                {{ obj.render|safe }}
                {% with related=obj.content_related.all %}
                {% if related %}
                <p>
                    <span class="text-muted">Profiles: </span>
                    {% for r in related %}
                    <a href="{{ r.profile.get_absolute_url }}">{{ r.profile.title }}</a>
                    {% if not forloop.last %} | {% endif %}
                    {% endfor %}
                </p>
                {% endif %}
                {% endwith %}

                <div class="d-flex flex-row">
                    <a
                        href="{% url 'item_update' mod_name obj.pk %}"
                        class="btn btn-secondary btn-sm me-1">
                        Edit
                    </a>
                    <form
                            method="post"
                            onsubmit="return confirm('This {{ mod_name }} will be removed from any profiles it appears in.\nAre you sure you wish to delete?');"
                            action="{% url 'item_delete' mod_name obj.pk %}">
                      <button class="btn btn-danger btn-sm me-1" type="submit" value="deleted">Delete</button>
                      {% csrf_token %}
                    </form>
                </div>
            </li>
            {% endfor %}
        </ul>
        {% endwith %}
        {% if not forloop.last %}<hr />{% endif %}
        {% endfor %}
    </div>
</div>
{% endif %}
{% empty %}
You don't have any content yet.
{% endfor %}

{% endblock %}